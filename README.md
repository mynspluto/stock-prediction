## MLOps 이해를 위한 주식 가격 예측 ETL + ML 파이프라인

### 프로젝트 목적
- 데이터 엔지니어링, 머신러닝의 전 과정을 경험
- Airflow, Hadoop, FastAPI, Kafka 기술에 대한 이해

### 만들고자 하는 것
- 주가 수집, 전처리, 적재 파이프라인
- 수집된 주가로 학습된 주가 예측 모델

### 기술 선택
필요에 의한 기술 선택이 아닌 자주 언급되는 기술을 선택하고 어떤 기능에 해당 기술을 사용할지 생각했습니다.

따라서 기능에 적합하지 않은 기술을 사용함과 오버 엔지니어링을 감수한 기술 선택입니다.

Airflow: 주가 수집, 전처리, 모델링 등 전체 flow 제어

Hadoop: 주가 데이터 월 별 분산 저장, 조회 시 맵리듀스로 통합, 모델 저장

FastAPI: 모델을 이용한 주가 예측 REST API 구현

Kafka: 주가 예측 API 요청 시, 장 중에 현재 가격이 예측된 가격과 일정 수준 이상의 괴리가 생기면 메시지 전송

### 데이터 flow

주가 수집 dag
1. 야후 파이낸스 API로 주가 데이터 수집
2. 기본 특성으로부터 새로운 특성 추가
3. 데이터를 월 별로 분리하여 YYYY-MM.json 형태로 여러 파일로 저장

모델 학습 dag
1. 월 별로 분리된 YYYY-MM.json을 MapReduce로 시간순으로 정렬하여 통합
2. 통합된 데이터를 통해 모델 학습
3. 모델 저장

![데이터플로우](/image/데이터플로우.png)

### 시스템 구조도
AWS EC2에 배포했었으나, 현재는 배포 중단 된 상태입니다.

서버는 1 대로 구성되어 있었으며 Minikube를 통해 쿠버네티스를 사용했습니다.

~.airflow.com, ~.next.com의 형태의 url 요청을 NginX와 Ingress를 활용하여 각 리소스에 분기했습니다.

![데이터플로우](/image/주가예측구성도.png)

### 차트 렌더링

![데이터플로우](/image/차트렌더.png)
